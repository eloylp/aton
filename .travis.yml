language: go
go:
  - 1.15.5

jobs:
  include:
    - name: "Linter"
      stage: linter
      script: make lint

    - name: "Unit tests"
      stage: unit-test
      script: make test-unit

    - name: "Integration tests"
      stage: integration-test
      branches:
        only:
          - master
      script: make test-integration

    - name: "Detector tests"
      stage: integration-test
      branches:
        only:
          - master
      before_script: make docker-test
      script: make test-detector
      services: docker

    - name: "Racy tests"
      stage: integration-test
      branches:
        only:
          - master
      script: make test-racy

    - name: "End to End tests"
      stage: integration-test
      branches:
        only:
          - master
      script: make test-racy

stages:
  - linter
  - unit-test
  - integration-test